<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Socket.IO Chat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { margin:0; font-family:system-ui, sans-serif; }
      #chat { display:flex; flex-direction:column; height:100vh; }
      ul#messages { list-style:none; margin:0; padding:0; flex:1; overflow:auto; }
      ul#messages li { padding:8px 12px; border-bottom:1px solid #eee; }
      form { display:flex; gap:8px; padding:8px; border-top:1px solid #eee; }
      input[type=text] { flex:1; padding:10px; }
      button { padding:10px 14px; cursor:pointer; }
      small.time { opacity:.6; margin-left:8px; }
    </style>
  </head>
  <body>
    <div id="chat">
      <ul id="messages"></ul>
      <form id="form" autocomplete="off">
        <input id="input" type="text" placeholder="Type a message…" />
        <button type="submit">Send</button>
      </form>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();

      const $messages = document.getElementById('messages');
      const $form = document.getElementById('form');
      const $input = document.getElementById('input');

      $form.addEventListener('submit', (e) => {
        e.preventDefault();
        const text = $input.value.trim();
        if (!text) return;
        socket.emit('chat message', text);
        $input.value = '';
        $input.focus();
      });

      socket.on('chat message', (payload) => {
        const li = document.createElement('li');
        const dt = new Date(payload.ts || Date.now());
        li.textContent = payload.msg;
        const time = document.createElement('small');
        time.className = 'time';
        time.textContent = dt.toLocaleTimeString();
        li.appendChild(time);
        $messages.appendChild(li);
        $messages.scrollTop = $messages.scrollHeight;
      });
    </script>
  </body>
</html>
